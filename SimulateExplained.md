`bin/simulate.rb`は、システムトレードのシミュレーションを実行するための中心的なスクリプトです。

### 概要

このスクリプトは、コマンドライン引数で与えられた**設定ファイル**を読み込み、その内容に基づいてシミュレーションを実行します。個別銘柄のテストと、リストにある全銘柄のテストの両方に対応しています。

### 実行方法

-   **全銘柄のシミュレーション:**
    ```bash
    ruby bin/simulate.rb <設定ファイル名>
    ```
-   **1銘柄のみのシミュレーション:**
    ```bash
    ruby bin/simulate.rb <設定ファイル名> <銘柄コード>
    ```

### 主な処理の流れ

1.  **ライブラリ読み込み:**
    -   シミュレーションに必要な基本的なクラス（`Simulation`, `TradingSystem`など）や、株価データをファイルから読み込むための`TextToStock`クラスなどを `require` します。

2.  **クラスの拡張（DSLの定義）:**
    -   `Simulation`クラスと`TradingSystem`クラスに、設定ファイルで使うためのメソッド（`setting`, `trading_system`, `entry`, `exit`など）を定義しています。これにより、設定ファイルを簡潔で読みやすい形式（DSL: ドメイン固有言語）で記述できます。

3.  **設定ファイルの読み込みと実行:**
    -   スクリプトの最後の行 `load ARGV[0]` がこのスクリプトの心臓部です。
    -   コマンドラインで指定された設定ファイル（例: `setting/estrangement.rb`）をRubyコードとして読み込み、実行します。

4.  **シミュレーションの開始:**
    -   設定ファイルが実行されると、その中にある `Simulation.setting do ... end` ブロックが呼び出されます。
    -   この `setting` メソッドが、ブロック内の設定（売買ルール、対象期間、データソースなど）を読み取って `Simulation` オブジェクトを準備します。
    -   最後に、コマンドライン引数 `ARGV[1]` (銘柄コード) があれば個別銘柄のシミュレーションを、なければ全銘柄のシミュレーションを開始します。

### 設定ファイルで使われる主要メソッド

-   `Simulation.setting(システム名, バージョン) do ... end`:
    シミュレーション全体の設定を定義します。
-   `trading_system do ... end`:
    売買戦略（トレーディングシステム）を定義します。
-   `entry`, `exit`, `stop`, `filter`:
    `trading_system`ブロック内で使用し、それぞれ仕掛け、手仕舞い、損切り、フィルターのルールとパラメータを指定します。
-   `data_loader`:
    株価データの読み込み方法（どのクラスを使うか）と、データがある場所などを指定します。
-   `from`, `to`:
    シミュレーションの対象期間を指定します。
-   `record_dir`:
    結果を出力するフォルダを指定します。

要約すると、このスクリプトは**設定ファイル駆動型**のシミュレータであり、本体のロジックを変更することなく、設定ファイル（`ARGV[0]`）を切り替えるだけで様々な売買戦略のテストができるように設計されています。
